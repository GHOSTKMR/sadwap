<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KUDU Assistant - AI Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #10a37f;
            --primary-hover: #0d8c6d;
            --sidebar-bg: #1a1b26;
            --chat-bg: #24283b;
            --user-msg-bg: #343541;
            --bot-msg-bg: #414868;
            --text-color: #c0caf5;
            --text-secondary: #9aa5ce;
            --border-color: #414868;
            --accent-color: #7aa2f7;
            --danger-color: #f7768e;
            --warning-color: #e0af68;
            --success-color: #9ece6a;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] {
            --primary-color: #10a37f;
            --primary-hover: #0d8c6d;
            --sidebar-bg: #f8fafc;
            --chat-bg: #ffffff;
            --user-msg-bg: #f1f5f9;
            --bot-msg-bg: #e2e8f0;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --accent-color: #3b82f6;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
            --glass-bg: rgba(0, 0, 0, 0.02);
            --glass-border: rgba(0, 0, 0, 0.05);
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }

        *::-webkit-scrollbar {
            width: 8px;
        }

        *::-webkit-scrollbar-track {
            background: transparent;
        }

        *::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 4px;
        }

        *::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }
        
        body {
            background: linear-gradient(135deg, var(--chat-bg) 0%, var(--sidebar-bg) 100%);
            color: var(--text-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .chat-container {
            height: 100vh;
            display: flex;
            backdrop-filter: blur(10px);
        }
        
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            background: var(--glass-bg);
        }
        
        .new-chat-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 18px;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
        }
        
        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.4);
        }

        .sidebar-controls {
            padding: 0 20px 15px;
            display: flex;
            gap: 8px;
        }

        .control-btn {
            flex: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .control-btn:hover {
            background: var(--glass-border);
            color: var(--text-color);
            transform: translateY(-1px);
        }

        .control-btn.danger:hover {
            background: var(--danger-color);
            color: white;
        }
        
        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px 20px;
        }
        
        .chat-item {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--glass-bg);
            border: 1px solid transparent;
        }
        
        .chat-item:hover {
            background: var(--glass-border);
            transform: translateX(4px);
            border-color: var(--glass-border);
        }
        
        .chat-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.2);
        }

        .chat-item-icon {
            width: 20px;
            text-align: center;
        }

        .chat-item-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-time {
            font-size: 0.7rem;
            opacity: 0.7;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--glass-border);
            background: var(--glass-bg);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--glass-bg);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            color: var(--text-color);
            background: var(--glass-bg);
        }
        
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--chat-bg);
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
        }

        .chat-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .menu-toggle:hover {
            background: var(--glass-bg);
        }

        .header-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            background: var(--glass-border);
            color: var(--text-color);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .message {
            display: flex;
            gap: 16px;
            max-width: 100%;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .user-message .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .bot-message .message-avatar {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        }
        
        .message-content {
            flex: 1;
            padding-top: 2px;
        }

        .message-bubble {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 16px 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .user-message .message-bubble {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-color: rgba(102, 126, 234, 0.2);
        }

        .bot-message .message-bubble {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(122, 162, 247, 0.1));
            border-color: rgba(16, 163, 127, 0.2);
        }
        
        .message-text {
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 8px;
            opacity: 0.8;
        }
        
        .chat-input-container {
            padding: 25px;
            border-top: 1px solid var(--glass-border);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
        }
        
        .chat-input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            background: var(--chat-bg);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            padding: 16px 60px 16px 20px;
            color: var(--text-color);
            resize: none;
            max-height: 200px;
            font-size: 1rem;
            line-height: 1.5;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }
        
        .send-btn {
            position: absolute;
            right: 12px;
            bottom: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border: none;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(16, 163, 127, 0.3);
        }
        
        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }
        
        .suggested-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 30px;
            max-width: 800px;
            width: 100%;
        }

        .question-chip {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 16px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            backdrop-filter: blur(10px);
        }

        .question-chip:hover {
            background: var(--glass-border);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .typing-indicator {
            display: flex;
            gap: 6px;
            padding: 16px 20px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary-color);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { 
                transform: scale(0.8); 
                opacity: 0.5; 
            }
            40% { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--sidebar-bg);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn.primary {
            background: var(--danger-color);
            color: white;
        }

        .modal-btn.secondary {
            background: var(--glass-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .stats-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                transform: translateX(-100%);
                width: 300px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .menu-toggle {
                display: flex;
            }

            .chat-header-right {
                display: none;
            }
            
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(3px);
                z-index: 999;
                display: none;
            }
            
            .overlay.active {
                display: block;
            }

            .welcome-title {
                font-size: 2rem;
            }

            .suggested-questions {
                grid-template-columns: 1fr;
            }

            .chat-messages {
                padding: 20px 15px;
                gap: 20px;
            }

            .chat-input-container {
                padding: 20px 15px;
            }

            .stats-container {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 280px;
            }

            .message {
                gap: 12px;
            }

            .message-avatar {
                width: 32px;
                height: 32px;
            }

            .message-bubble {
                padding: 14px 16px;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" id="newChatBtn">
                    <i class="fas fa-plus"></i> New Chat
                </button>
            </div>
            
            <div class="sidebar-controls">
                <button class="control-btn" id="exportBtn" title="Export Chat">
                    <i class="fas fa-download"></i>
                </button>
                <button class="control-btn danger" id="clearHistoryBtn" title="Clear History">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <div class="chat-history" id="chatHistory">
                <!-- Chat history will be populated here -->
            </div>
            
            <div class="sidebar-footer">
                <div class="stats-container" id="statsContainer">
                    <div class="stat-item">
                        <div class="stat-number" id="totalChats">0</div>
                        <div class="stat-label">Chats</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div class="stat-label">Messages</div>
                    </div>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">KUDU User</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Online</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h5 class="mb-0">KUDU Assistant</h5>
                        <small class="text-muted">AI-Powered Restaurant Assistant</small>
                    </div>
                </div>
                
                <div class="chat-header-right">
                    <button class="header-btn" id="shareBtn" title="Share Chat">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="header-btn" id="settingsBtn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-logo">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">Welcome to KUDU Assistant</h1>
                    <p class="welcome-subtitle">Your intelligent restaurant companion. Ask me anything about KUDU!</p>
                    
                    <div class="suggested-questions" id="suggestedQuestions">
                        <!-- Suggested questions will be added here dynamically -->
                    </div>
                </div>
                
                <!-- Messages will be added here dynamically -->
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" rows="1" placeholder="Ask about KUDU restaurants, menu, history..."></textarea>
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile overlay -->
        <div class="overlay" id="overlay"></div>
    </div>

    <!-- Clear History Modal -->
    <div class="modal" id="clearModal">
        <div class="modal-content">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning-color); margin-bottom: 20px;"></i>
            <h4>Clear Chat History?</h4>
            <p style="color: var(--text-secondary); margin-bottom: 0;">This action cannot be undone. All your chat history will be permanently deleted.</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelClear">Cancel</button>
                <button class="modal-btn primary" id="confirmClear">Clear All</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced knowledge base with more comprehensive information
        let knowledgeBase = {
            "kudu history": "The first KUDU restaurant opened in Riyadh on April 16th, 1988. During the following 4 years, 7 more locations were added in Riyadh. In 1992, the first restaurant outside of Riyadh opened in Jeddah. In 1993, expansion continued in the Eastern province of KSA. In the following years, KUDU expanded to cover Abha, Tabuk, Taif, Madinah, and the central province. In 2003, KUDU ventured into the franchise system and opened franchise outlets inside and outside the Kingdom, in Kuwait and UAE. In 2004, KUDU signed a franchise agreement to open its second outlet in Sudan. In 2008, KUDU franchise opened 2 branches in Jordan. Expansion occurred outside of the Kingdom of Saudi Arabia into other countries in the Gulf region. In October 2021, Al Rashed and Al Said group completed a buyout of KUDU Company for Food and Catering.",
            
            "brand message": "KUDU's brand message is 'Taste you can see'. It aims to bridge the gap between what KUDU stands for and the young generation, focusing on visual appeal and quality that customers can immediately recognize.",


 "kudu mission": "To be a leading Saudi brand in the field of fast-food restaurants, offering delicious, fresh high-quality foods with a unique experience and a different anddistinctive preparation method",

"kudu vision": "To be a leading Saudi company in the field of restaurants, with a strong international network of multi-formats franchised partnerships.",

"kudu CORE VALUES": "Customer First,Transparency,Teamwork,Excellence",







            
           
            
            "default": "I'm sorry, I don't have specific information about that topic. Please ask the developer to add more information to the database, or try asking about KUDU's history, menu, locations, or services."
        };

        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        const chatHistory = document.getElementById('chatHistory');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.getElementById('overlay');
        const suggestedQuestions = document.getElementById('suggestedQuestions');
        const themeToggle = document.getElementById('themeToggle');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const exportBtn = document.getElementById('exportBtn');
        const clearModal = document.getElementById('clearModal');
        const cancelClear = document.getElementById('cancelClear');
        const confirmClear = document.getElementById('confirmClear');
        const shareBtn = document.getElementById('shareBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const totalChats = document.getElementById('totalChats');
        const totalMessages = document.getElementById('totalMessages');

        // Chat state
        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('kudu_chats')) || {};
        let currentTheme = localStorage.getItem('kudu_theme') || 'dark';
        let isTyping = false;
        
        // Initialize the app
        function init() {
            // Set theme
            document.body.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
            
            // Load chat history
            renderChatHistory();
            updateStats();
            
            // Render suggested questions
            renderSuggestedQuestions();
            
            // Set up event listeners
            sendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keydown', handleInputKeydown);
            chatInput.addEventListener('input', autoResizeTextarea);
            
            newChatBtn.addEventListener('click', startNewChat);
            menuToggle.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', closeSidebar);
            themeToggle.addEventListener('click', toggleTheme);
            clearHistoryBtn.addEventListener('click', showClearModal);
            exportBtn.addEventListener('click', exportChats);
            shareBtn.addEventListener('click', shareCurrentChat);
            settingsBtn.addEventListener('click', showSettings);
            
            // Modal event listeners
            cancelClear.addEventListener('click', hideClearModal);
            confirmClear.addEventListener('click', clearAllHistory);
            
            // Close modal when clicking outside
            clearModal.addEventListener('click', (e) => {
                if (e.target === clearModal) hideClearModal();
            });
            
            // Load last active chat if exists
            const lastChatId = localStorage.getItem('kudu_last_chat');
            if (lastChatId && chats[lastChatId]) {
                loadChat(lastChatId);
            }
        }
        
        // Handle input keydown
        function handleInputKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!isTyping) sendMessage();
            }
        }
        
        // Toggle theme
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', currentTheme);
            localStorage.setItem('kudu_theme', currentTheme);
            updateThemeIcon();
        }
        
        // Update theme icon
        function updateThemeIcon() {
            const icon = themeToggle.querySelector('i');
            icon.className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
        
        // Show clear modal
        function showClearModal() {
            clearModal.classList.add('active');
        }
        
        // Hide clear modal
        function hideClearModal() {
            clearModal.classList.remove('active');
        }
        
        // Clear all history
        function clearAllHistory() {
            chats = {};
            currentChatId = null;
            localStorage.removeItem('kudu_chats');
            localStorage.removeItem('kudu_last_chat');
            
            renderChatHistory();
            updateStats();
            showWelcomeScreen();
            hideClearModal();
            
            // Show success message
            showNotification('Chat history cleared successfully!', 'success');
        }
        
        // Export chats
        function exportChats() {
            if (Object.keys(chats).length === 0) {
                showNotification('No chats to export!', 'warning');
                return;
            }
            
            const exportData = {
                chats: chats,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kudu-chats-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Chats exported successfully!', 'success');
        }
        
        // Share current chat
        function shareCurrentChat() {
            if (!currentChatId) {
                showNotification('No active chat to share!', 'warning');
                return;
            }
            
            const chat = chats[currentChatId];
            const shareText = `Check out my conversation with KUDU Assistant:\n\n${chat.title}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'KUDU Assistant Chat',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('Chat details copied to clipboard!', 'success');
                });
            }
        }
        
        // Show settings (placeholder)
        function showSettings() {
            showNotification('Settings panel coming soon!', 'info');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--${type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'danger' : 'primary'}-color);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 3000;
                font-weight: 600;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Update statistics
        function updateStats() {
            const chatCount = Object.keys(chats).length;
            const messageCount = Object.values(chats).reduce((total, chat) => total + chat.messages.length, 0);
            
            totalChats.textContent = chatCount;
            totalMessages.textContent = messageCount;
        }
        
        // Render suggested questions
        function renderSuggestedQuestions() {
            suggestedQuestions.innerHTML = '';
            
            const questions = [
                "Tell me about KUDU's history",
                "What's KUDU's brand message?",
                "What menu items does KUDU offer?",
                "Where are KUDU locations?",
                "What are KUDU's opening hours?",
                "Does KUDU offer delivery service?"
            ];
            
            questions.forEach(question => {
                const chip = document.createElement('div');
                chip.className = 'question-chip';
                chip.innerHTML = `<i class="fas fa-comment-dots" style="margin-right: 8px; opacity: 0.7;"></i>${question}`;
                chip.addEventListener('click', () => {
                    chatInput.value = question;
                    sendMessage();
                });
                suggestedQuestions.appendChild(chip);
            });
        }
        
        // Auto-resize textarea
        function autoResizeTextarea() {
            chatInput.style.height = 'auto';
            chatInput.style.height = Math.min(chatInput.scrollHeight, 200) + 'px';
        }
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // Close sidebar on mobile
        function closeSidebar() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // Show welcome screen
        function showWelcomeScreen() {
            chatMessages.innerHTML = '';
            chatMessages.appendChild(welcomeScreen);
            welcomeScreen.style.display = 'flex';
        }
        
        // Start a new chat
        function startNewChat() {
            currentChatId = 'chat_' + Date.now();
            chats[currentChatId] = {
                id: currentChatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            saveChats();
            renderChatHistory();
            updateStats();
            showWelcomeScreen();
            closeSidebar();
            
            // Focus input
            chatInput.focus();
        }
        
        // Save chats to localStorage
        function saveChats() {
            localStorage.setItem('kudu_chats', JSON.stringify(chats));
            if (currentChatId) {
                localStorage.setItem('kudu_last_chat', currentChatId);
            }
        }
        
        // Render chat history in sidebar
        function renderChatHistory() {
            chatHistory.innerHTML = '';
            
            const chatIds = Object.keys(chats);
            if (chatIds.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.style.cssText = `
                    text-align: center;
                    padding: 40px 20px;
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                `;
                emptyState.innerHTML = `
                    <i class="fas fa-comments" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                    <div>No conversations yet</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">Start a new chat to begin</div>
                `;
                chatHistory.appendChild(emptyState);
                return;
            }
            
            // Sort chats by creation date (newest first)
            chatIds.sort((a, b) => new Date(chats[b].createdAt) - new Date(chats[a].createdAt));
            
            chatIds.forEach(chatId => {
                const chat = chats[chatId];
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${chatId === currentChatId ? 'active' : ''}`;
                
                const timeAgo = getTimeAgo(new Date(chat.createdAt));
                
                chatItem.innerHTML = `
                    <div class="chat-item-icon">
                        <i class="far fa-message"></i>
                    </div>
                    <div class="chat-item-text">${chat.title}</div>
                    <div class="chat-item-time">${timeAgo}</div>
                `;
                
                chatItem.addEventListener('click', () => {
                    loadChat(chatId);
                    closeSidebar();
                });
                
                chatHistory.appendChild(chatItem);
            });
        }
        
        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'now';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffHours < 24) return `${diffHours}h`;
            if (diffDays < 7) return `${diffDays}d`;
            return date.toLocaleDateString();
        }
        
        // Load a specific chat
        function loadChat(chatId) {
            currentChatId = chatId;
            const chat = chats[chatId];
            
            // Update active state in sidebar
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the correct chat item
            const chatItems = document.querySelectorAll('.chat-item');
            const chatIds = Object.keys(chats).sort((a, b) => new Date(chats[b].createdAt) - new Date(chats[a].createdAt));
            const chatIndex = chatIds.indexOf(chatId);
            if (chatItems[chatIndex]) {
                chatItems[chatIndex].classList.add('active');
            }
            
            // Clear messages and render chat messages
            chatMessages.innerHTML = '';
            welcomeScreen.style.display = 'none';
            
            if (chat.messages.length === 0) {
                showWelcomeScreen();
                return;
            }
            
            chat.messages.forEach(message => {
                addMessageToChat(message.text, message.sender, message.timestamp, false);
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
            saveChats(); // Save last active chat
        }
        
        // Send a message
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isTyping) return;
            
            // Clear input and reset height
            chatInput.value = '';
            chatInput.style.height = 'auto';
            
            // If no active chat, create one
            if (!currentChatId) {
                startNewChat();
            }
            
            // Add user message
            addMessageToChat(message, 'user');
            
            // Update chat title if it's the first message
            if (chats[currentChatId].messages.length === 0) {
                chats[currentChatId].title = message.length > 40 ? message.substring(0, 40) + '...' : message;
                saveChats();
                renderChatHistory();
            }
            
            // Save user message to chat
            chats[currentChatId].messages.push({
                text: message,
                sender: 'user',
                timestamp: new Date().toISOString()
            });
            saveChats();
            updateStats();
            
            // Set typing state
            isTyping = true;
            sendBtn.disabled = true;
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response after a delay
            const responseDelay = 1500 + Math.random() * 1500;
            setTimeout(() => {
                removeTypingIndicator();
                const response = generateResponse(message);
                addMessageToChat(response, 'bot');
                
                // Save bot response to chat
                chats[currentChatId].messages.push({
                    text: response,
                    sender: 'bot',
                    timestamp: new Date().toISOString()
                });
                saveChats();
                updateStats();
                
                // Reset typing state
                isTyping = false;
                sendBtn.disabled = false;
            }, responseDelay);
        }
        
        // Generate AI response with improved matching
        function generateResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for exact matches first
            for (const [question, answer] of Object.entries(knowledgeBase)) {
                if (question !== 'default' && lowerMessage.includes(question.toLowerCase())) {
                    return answer;
                }
            }
            
            // Check for keyword matches
            const keywords = {
                'history': 'kudu history',
                'brand': 'brand message',
                'menu': 'menu items',
                'food': 'menu items',
                'location': 'locations',
                'where': 'locations',
                'hours': 'opening hours',
                'time': 'opening hours',
                'delivery': 'delivery service',
                'contact': 'contact information'
            };
            
            for (const [keyword, topic] of Object.entries(keywords)) {
                if (lowerMessage.includes(keyword) && knowledgeBase[topic]) {
                    return knowledgeBase[topic];
                }
            }
            
            // Check for partial matches with better scoring
            let bestMatch = null;
            let bestScore = 0;
            
            for (const [question, answer] of Object.entries(knowledgeBase)) {
                if (question === 'default') continue;
                
                const questionWords = question.toLowerCase().split(' ');
                const messageWords = lowerMessage.split(' ');
                
                // Count matching words and calculate score
                const matchingWords = questionWords.filter(word => 
                    messageWords.some(msgWord => 
                        msgWord.includes(word) || word.includes(msgWord) || 
                        levenshteinDistance(word, msgWord) <= 2
                    )
                );
                
                const score = matchingWords.length / questionWords.length;
                if (score > bestScore && score > 0.3) {
                    bestScore = score;
                    bestMatch = answer;
                }
            }
            
            return bestMatch || knowledgeBase.default;
        }
        
        // Simple Levenshtein distance for fuzzy matching
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }
        
        // Add message to chat UI
        function addMessageToChat(text, sender, timestamp = null, scroll = true) {
            welcomeScreen.style.display = 'none';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const now = timestamp ? new Date(timestamp) : new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>'}
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="message-text">${text}</div>
                        <div class="message-time">${timeString}</div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            if (scroll) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
