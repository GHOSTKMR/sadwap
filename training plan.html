<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant KS22 - Training Plan</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            max-width: 95%;
            margin: 0 auto;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a252f 100%);
            color: white;
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            margin-bottom: 2rem;
        }
        
        .app-header h1 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }
        
        .app-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .header-inputs .form-control {
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .header-inputs .form-control:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
            color: white;
        }
        
        .header-inputs .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            height: 100%;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-icon.employees { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .stats-icon.completion { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .stats-icon.stations { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }
        .stats-icon.trainers { background: linear-gradient(135deg, #f39c12 0%, #d35400 100%); color: white; }
        
        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }
        
        .stats-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .management-card {
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        .management-card .card-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);
            color: white;
            border-bottom: none;
            padding: 1.25rem 1.5rem;
            font-weight: 600;
        }
        
        .management-card .card-body {
            padding: 1.5rem;
        }
        
        .station-tag {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.2);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .station-tag .btn-sm {
            padding: 0.125rem 0.375rem;
            font-size: 0.75rem;
        }
        
        .table-responsive-container {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .training-table {
            margin: 0;
            width: 100%;
            font-size: 0.85rem;
        }
        
        .training-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--primary-color);
            font-weight: 600;
            padding: 0.75rem;
            border-color: #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
            vertical-align: middle;
        }
        
        .training-table td {
            padding: 0.5rem;
            border-color: #dee2e6;
            vertical-align: middle;
            min-width: 120px;
        }
        
        .employee-name-cell {
            position: sticky;
            left: 0;
            background: white;
            z-index: 5;
            min-width: 180px;
        }
        
        .employee-id-cell {
            position: sticky;
            left: 180px;
            background: white;
            z-index: 5;
            min-width: 120px;
        }
        
        .station-cell {
            background: #f8f9fa;
            transition: var(--transition);
        }
        
        .station-cell.completed {
            background: #d4edda !important;
        }
        
        .station-cell.in-progress {
            background: #fff3cd !important;
        }
        
        .station-cell.pending {
            background: #f8d7da !important;
        }
        
        .station-cell.deadline-today {
            background: #ffcc00 !important;
            border: 2px solid #ff9900 !important;
            animation: pulse 2s infinite;
        }
        
        .station-cell.deadline-passed {
            background: #ff6666 !important;
            border: 2px solid #ff0000 !important;
            animation: shake 0.5s ease-in-out;
        }
        
        .station-header {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-right: 1px solid #dee2e6;
            position: relative;
        }
        
        .station-header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .station-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .station-code {
            font-size: 0.7rem;
            color: #6c757d;
            background: rgba(255, 255, 255, 0.5);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
        }
        
        .station-header .edit-btn {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            opacity: 0;
            transition: var(--transition);
        }
        
        .station-header:hover .edit-btn {
            opacity: 1;
        }
        
        .station-inputs {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .station-inputs select,
        .station-inputs input {
            font-size: 0.8rem;
            padding: 0.375rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
        }
        
        .station-inputs select:focus,
        .station-inputs input:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.1);
        }
        
        .date-range-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 200px;
        }
        
        .date-range-inputs input {
            flex: 1;
            min-width: 90px;
        }
        
        .date-range-separator {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            min-width: 120px;
        }
        
        .btn-action {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 350px;
            max-width: 90%;
            z-index: 1050;
        }
        
        .notification-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border: none;
            margin-bottom: 10px;
            overflow: hidden;
            animation: slideInRight 0.5s ease-out;
        }
        
        .notification-header {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
            color: white;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-body {
            padding: 1rem;
            background: #fff9e6;
        }
        
        .notification-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--warning-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .notification-item.critical {
            border-left-color: var(--danger-color);
            background: #fff5f5;
        }
        
        .notification-item.today {
            border-left-color: var(--warning-color);
            background: #fff9e6;
        }
        
        .notification-item.upcoming {
            border-left-color: var(--info-color);
            background: #e8f4fd;
        }
        
        .notification-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 1060;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.5);
            animation: bounce 2s infinite;
        }
        
        /* Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 153, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 153, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 153, 0, 0); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Modal Styling */
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a252f 100%);
            color: white;
            border-bottom: none;
        }
        
        .modal-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* Toast Notifications */
        .toast-container {
            z-index: 1060;
        }
        
        .toast {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }
            
            .main-container {
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                max-width: 100% !important;
            }
            
            .no-print, .notification-panel, .notification-badge {
                display: none !important;
            }
            
            .training-table th,
            .training-table td {
                border: 1px solid #333 !important;
            }
            
            .station-cell {
                background: #fff !important;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-bg: #2c3e50;
                --dark-bg: #1a252f;
            }
            
            .main-container {
                background: var(--dark-bg);
                color: #f8f9fa;
            }
            
            .stats-card {
                background: #34495e;
                color: #f8f9fa;
                border-color: #4a6278;
            }
            
            .stats-value {
                color: #f8f9fa;
            }
            
            .stats-label {
                color: #bdc3c7;
            }
            
            .training-table th {
                background: #34495e;
                color: #f8f9fa;
                border-color: #4a6278;
            }
            
            .training-table td {
                background: #2c3e50;
                color: #f8f9fa;
                border-color: #4a6278;
            }
            
            .employee-name-cell,
            .employee-id-cell {
                background: #2c3e50;
            }
            
            .notification-card {
                background: #34495e;
                color: #f8f9fa;
            }
            
            .notification-body {
                background: #2c3e50;
            }
            
            .notification-item {
                background: #3c556e;
            }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .app-header {
                padding: 1.5rem;
            }
            
            .app-header h1 {
                font-size: 1.8rem;
            }
            
            .stats-value {
                font-size: 1.5rem;
            }
            
            .training-table {
                font-size: 0.75rem;
            }
            
            .station-inputs select,
            .station-inputs input {
                font-size: 0.7rem;
                padding: 0.25rem;
            }
            
            .notification-panel {
                width: 300px;
                right: 10px;
                top: 80px;
            }
        }
        
        @media (max-width: 576px) {
            .app-header {
                padding: 1rem;
            }
            
            .app-header h1 {
                font-size: 1.5rem;
            }
            
            .header-inputs .row {
                gap: 0.5rem;
            }
            
            .header-inputs .col-md-6 {
                width: 100%;
            }
            
            .stats-card {
                padding: 1rem;
            }
            
            .stats-icon {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }
            
            .notification-panel {
                width: 280px;
                right: 5px;
                top: 70px;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1c5d87 100%);
        }
    </style>
</head>
<body>
    <!-- Notification Badge -->
    <div id="notificationBadge" class="notification-badge" onclick="toggleNotifications()" style="display: none;">
        <span id="notificationCount">0</span>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel" style="display: none;">
        <div class="notification-card">
            <div class="notification-header">
                <i class="bi bi-bell-fill"></i>
                <strong>Training Deadlines</strong>
                <button class="btn btn-sm btn-light ms-auto" onclick="closeAllNotifications()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="notification-body">
                <div id="notificationsList">
                    <!-- Notifications will be inserted here -->
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted">Notifications auto-check every hour</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container-fluid main-container">
        <!-- App Header -->
        <div class="app-header">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h1><i class="bi bi-journal-check me-2"></i>Restaurant KS22</h1>
                    <p class="mb-0">Training Plan Management System</p>
                </div>
                <div class="col-lg-6">
                    <div class="header-inputs">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="store" placeholder="Store Name (e.g., KS-22)" value="KS-22">
                            </div>
                            <div class="col-md-6">
                                <input type="month" class="form-control" id="month" value="2026-01">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container-fluid px-4 pb-4">
            <!-- Stats Cards -->
            <div class="row g-4 mb-4">
                <div class="col-xl-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon employees">
                            <i class="bi bi-people-fill"></i>
                        </div>
                        <div class="stats-value" id="totalEmployees">0</div>
                        <div class="stats-label">Total Employees</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon completion">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="stats-value" id="trainingCompletion">0%</div>
                        <div class="stats-label">Training Completion</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon stations">
                            <i class="bi bi-building-fill"></i>
                        </div>
                        <div class="stats-value" id="totalStations">0</div>
                        <div class="stats-label">Total Stations</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon trainers">
                            <i class="bi bi-person-badge-fill"></i>
                        </div>
                        <div class="stats-value" id="activeTrainers">0</div>
                        <div class="stats-label">Active Trainers</div>
                    </div>
                </div>
            </div>

            <!-- Management Cards -->
            <div class="row g-4 mb-4">
                <!-- Stations Management -->
                <div class="col-xl-6">
                    <div class="management-card h-100">
                        <div class="card-header">
                            <i class="bi bi-building me-2"></i>Manage Training Stations
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="stations-list mb-3" id="stationsList">
                                    <!-- Stations will be listed here -->
                                </div>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="newStationName" placeholder="Enter new station name">
                                    <button class="btn btn-success" onclick="addNewStation()" id="addStationBtn">
                                        <i class="bi bi-plus-lg"></i> Add
                                    </button>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary flex-fill" onclick="resetToDefaultStations()">
                                    <i class="bi bi-arrow-clockwise me-1"></i> Reset Stations
                                </button>
                                <button class="btn btn-outline-secondary flex-fill" onclick="exportStationsList()">
                                    <i class="bi bi-download me-1"></i> Export List
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trainers & Employees Management -->
                <div class="col-xl-6">
                    <div class="management-card h-100">
                        <div class="card-header">
                            <i class="bi bi-person-badge me-2"></i>Manage Trainers & Employees
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label class="form-label">Trainers List</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="trainerList" placeholder="Trainers (comma separated)" value="Odin, Mueen, Sarah, Alex, Maria">
                                        <button class="btn btn-primary" onclick="updateTrainers()">
                                            <i class="bi bi-check-lg"></i> Update
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label">Employee ID Format</label>
                                    <input type="text" class="form-control" id="employeeId" placeholder="Default Employee ID Format" value="EMP-">
                                </div>
                                <div class="col-md-12">
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-success flex-fill" onclick="addEmployee()">
                                            <i class="bi bi-person-plus me-1"></i> Add Employee
                                        </button>
                                        <button class="btn btn-warning flex-fill" onclick="addMultipleRows()">
                                            <i class="bi bi-people-fill me-1"></i> Add 5
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="enableNotifications" checked>
                                        <label class="form-check-label" for="enableNotifications">
                                            Enable Deadline Notifications
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Training Table -->
            <div class="table-responsive-container">
                <div class="table-responsive">
                    <table class="table table-bordered training-table">
                        <thead id="tableHead">
                            <!-- Table headers will be generated here -->
                        </thead>
                        <tbody id="tableBody">
                            <!-- Table data will be generated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <button class="btn btn-primary" onclick="exportExcel()">
                            <i class="bi bi-file-earmark-excel me-2"></i>Export Excel
                        </button>
                        <button class="btn btn-success" onclick="exportPDF()">
                            <i class="bi bi-file-earmark-pdf me-2"></i>Export PDF
                        </button>
                        <button class="btn btn-warning" onclick="printTable()">
                            <i class="bi bi-printer me-2"></i>Print
                        </button>
                        <button class="btn btn-info" onclick="checkDeadlinesNow()">
                            <i class="bi bi-bell-fill me-2"></i>Check Deadlines
                        </button>
                        <button class="btn btn-danger" onclick="clearAll()">
                            <i class="bi bi-trash3 me-2"></i>Clear All
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Station Modal -->
    <div class="modal fade" id="editStationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Station</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editStationName" class="form-label">Station Name</label>
                        <input type="text" class="form-control" id="editStationName" placeholder="Enter station name">
                    </div>
                    <div class="mb-3">
                        <label for="editStationCode" class="form-label">Station Code (3 letters)</label>
                        <input type="text" class="form-control" id="editStationCode" placeholder="e.g., ESS" maxlength="3">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveStationEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="statusToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-info-circle me-2"></i>
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will appear here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // DOM Elements
        const tbody = document.getElementById("tableBody");
        const thead = document.getElementById("tableHead");
        const storeInput = document.getElementById("store");
        const monthInput = document.getElementById("month");
        const trainerListInput = document.getElementById("trainerList");
        const employeeIdInput = document.getElementById("employeeId");
        const newStationNameInput = document.getElementById("newStationName");
        const stationsList = document.getElementById("stationsList");
        const notificationBadge = document.getElementById("notificationBadge");
        const notificationPanel = document.getElementById("notificationPanel");
        const notificationCount = document.getElementById("notificationCount");
        const notificationsList = document.getElementById("notificationsList");
        const enableNotifications = document.getElementById("enableNotifications");
        const editStationModal = new bootstrap.Modal(document.getElementById('editStationModal'));
        const editStationNameInput = document.getElementById("editStationName");
        const editStationCodeInput = document.getElementById("editStationCode");
        const statusToast = new bootstrap.Toast(document.getElementById('statusToast'));
        const toastMessage = document.getElementById('toastMessage');
        
        // Stats elements
        const totalEmployeesEl = document.getElementById("totalEmployees");
        const trainingCompletionEl = document.getElementById("trainingCompletion");
        const totalStationsEl = document.getElementById("totalStations");
        const activeTrainersEl = document.getElementById("activeTrainers");

        // Default restaurant stations
        const DEFAULT_STATIONS = [
            { id: "ess", name: "Essentials", code: "ESS" },
            { id: "prep", name: "Preparations", code: "PREP" },
            { id: "brk", name: "Breakfast", code: "BRK" },
            { id: "burg", name: "Burger Station", code: "BURG" },
            { id: "steak", name: "Steak Station", code: "STEAK" },
            { id: "side", name: "Side Items", code: "SIDE" },
            { id: "dess", name: "Deserts", code: "DESS" },
            { id: "equip", name: "Equipment", code: "EQUIP" },
            { id: "gs", name: "Guest Service", code: "GS" }
        ];

        // Configuration
        let stations = [];
        let trainers = [];
        let employees = [];
        let nextEmployeeId = 1001;
        let editingStationId = null;
        let notifications = [];
        let notificationCheckInterval;
        let lastCheckedDate = new Date().toDateString();

        // Initialize
        function init() {
            loadConfig();
            renderStationsList();
            renderTable();
            updateProgressSummary();
            setupEventListeners();
            startNotificationChecker();
            showToast("Training Plan Manager Loaded", "success");
            
            // Initial check for deadlines
            checkTrainingDeadlines();
        }

        // Load configuration
        function loadConfig() {
            const config = JSON.parse(localStorage.getItem("restaurantTrainingConfig")) || {
                stations: DEFAULT_STATIONS,
                trainers: ["Odin", "Mueen", "Sarah", "Alex", "Maria"],
                employees: [],
                nextEmployeeId: 1001,
                notificationsEnabled: true
            };
            
            stations = config.stations || DEFAULT_STATIONS;
            trainers = config.trainers;
            employees = config.employees || [];
            nextEmployeeId = config.nextEmployeeId || 1001;
            enableNotifications.checked = config.notificationsEnabled !== false;
            
            trainerListInput.value = trainers.join(", ");
            
            // Set current month if empty
            if (!monthInput.value) {
                const now = new Date();
                monthInput.value = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
            }
        }

        // Save configuration
        function saveConfig() {
            const config = {
                stations: stations,
                trainers: trainers,
                employees: employees,
                nextEmployeeId: nextEmployeeId,
                notificationsEnabled: enableNotifications.checked
            };
            localStorage.setItem("restaurantTrainingConfig", JSON.stringify(config));
        }

        // Start notification checker
        function startNotificationChecker() {
            if (notificationCheckInterval) {
                clearInterval(notificationCheckInterval);
            }
            
            // Check every hour
            notificationCheckInterval = setInterval(() => {
                if (enableNotifications.checked) {
                    const today = new Date().toDateString();
                    if (today !== lastCheckedDate) {
                        checkTrainingDeadlines();
                        lastCheckedDate = today;
                    }
                }
            }, 60 * 60 * 1000); // 1 hour
            
            // Also check when page becomes visible
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden && enableNotifications.checked) {
                    checkTrainingDeadlines();
                }
            });
        }

        // Check training deadlines
        function checkTrainingDeadlines() {
            if (!enableNotifications.checked) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const dayAfterTomorrow = new Date(today);
            dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
            
            notifications = [];
            
            employees.forEach(employee => {
                if (!employee.stations) return;
                
                stations.forEach(station => {
                    const stationData = employee.stations[station.id];
                    if (!stationData || !stationData.completionDate) return;
                    
                    const completionDate = new Date(stationData.completionDate);
                    completionDate.setHours(0, 0, 0, 0);
                    
                    const daysDifference = Math.ceil((completionDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysDifference === 0) {
                        // Due today
                        notifications.push({
                            type: 'today',
                            message: `TODAY: ${employee.name} has final assessment for ${station.name}`,
                            employee: employee.name,
                            station: station.name,
                            date: stationData.completionDate,
                            days: 0,
                            critical: true
                        });
                    } else if (daysDifference < 0) {
                        // Past due
                        const daysOverdue = Math.abs(daysDifference);
                        notifications.push({
                            type: 'overdue',
                            message: `OVERDUE by ${daysOverdue} day${daysOverdue > 1 ? 's' : ''}: ${employee.name}'s ${station.name} assessment`,
                            employee: employee.name,
                            station: station.name,
                            date: stationData.completionDate,
                            days: daysOverdue,
                            critical: true
                        });
                    } else if (daysDifference === 1) {
                        // Due tomorrow
                        notifications.push({
                            type: 'tomorrow',
                            message: `TOMORROW: ${employee.name}'s ${station.name} final assessment`,
                            employee: employee.name,
                            station: station.name,
                            date: stationData.completionDate,
                            days: 1
                        });
                    } else if (daysDifference <= 3) {
                        // Due in 3 days
                        notifications.push({
                            type: 'upcoming',
                            message: `In ${daysDifference} days: ${employee.name}'s ${station.name} assessment`,
                            employee: employee.name,
                            station: station.name,
                            date: stationData.completionDate,
                            days: daysDifference
                        });
                    }
                });
            });
            
            updateNotificationDisplay();
            highlightDeadlineCells();
            
            // Show toast for today's deadlines
            const todayDeadlines = notifications.filter(n => n.days === 0);
            if (todayDeadlines.length > 0) {
                showDeadlineToast(todayDeadlines);
            }
        }

        // Update notification display
        function updateNotificationDisplay() {
            notificationCount.textContent = notifications.length;
            
            if (notifications.length > 0) {
                notificationBadge.style.display = 'flex';
            } else {
                notificationBadge.style.display = 'none';
                notificationPanel.style.display = 'none';
            }
            
            notificationsList.innerHTML = '';
            
            // Sort notifications: overdue -> today -> tomorrow -> upcoming
            const sortedNotifications = [...notifications].sort((a, b) => {
                if (a.type === 'overdue' && b.type !== 'overdue') return -1;
                if (a.type !== 'overdue' && b.type === 'overdue') return 1;
                if (a.type === 'today' && b.type !== 'today') return -1;
                if (a.type !== 'today' && b.type === 'today') return 1;
                if (a.type === 'tomorrow' && b.type !== 'tomorrow') return -1;
                if (a.type !== 'tomorrow' && b.type === 'tomorrow') return 1;
                return a.days - b.days;
            });
            
            sortedNotifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = `notification-item ${notification.type}`;
                
                const icon = notification.type === 'overdue' ? 'bi-exclamation-triangle-fill' :
                            notification.type === 'today' ? 'bi-calendar-check-fill' :
                            notification.type === 'tomorrow' ? 'bi-calendar2-day-fill' : 'bi-calendar-week-fill';
                
                const badgeColor = notification.type === 'overdue' ? 'danger' :
                                 notification.type === 'today' ? 'warning' :
                                 notification.type === 'tomorrow' ? 'info' : 'primary';
                
                item.innerHTML = `
                    <div class="d-flex align-items-start">
                        <i class="bi ${icon} text-${badgeColor} me-2 mt-1"></i>
                        <div class="flex-grow-1">
                            <div class="fw-bold">${notification.message}</div>
                            <small class="text-muted">
                                ${notification.employee} | ${notification.station} | Due: ${formatDate(notification.date)}
                            </small>
                        </div>
                        ${notification.critical ? 
                            '<span class="badge bg-danger ms-2">URGENT</span>' : 
                            `<span class="badge bg-${badgeColor} ms-2">${notification.days === 0 ? 'TODAY' : `${notification.days}D`}</span>`
                        }
                    </div>
                `;
                notificationsList.appendChild(item);
            });
        }

        // Highlight deadline cells in table
        function highlightDeadlineCells() {
            // Remove previous highlights
            document.querySelectorAll('.station-cell').forEach(cell => {
                cell.classList.remove('deadline-today', 'deadline-passed');
            });
            
            if (!enableNotifications.checked) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            employees.forEach((employee, empIndex) => {
                if (!employee.stations) return;
                
                stations.forEach((station, stationIndex) => {
                    const stationData = employee.stations[station.id];
                    if (!stationData || !stationData.completionDate) return;
                    
                    const completionDate = new Date(stationData.completionDate);
                    completionDate.setHours(0, 0, 0, 0);
                    
                    const daysDifference = Math.ceil((completionDate - today) / (1000 * 60 * 60 * 24));
                    
                    const row = tbody.querySelector(`tr:nth-child(${empIndex + 1})`);
                    if (row) {
                        const cell = row.querySelector(`td:nth-child(${stationIndex + 4})`);
                        if (cell) {
                            if (daysDifference === 0) {
                                cell.classList.add('deadline-today');
                            } else if (daysDifference < 0) {
                                cell.classList.add('deadline-passed');
                            }
                        }
                    }
                });
            });
        }

        // Show deadline toast
        function showDeadlineToast(todayDeadlines) {
            const count = todayDeadlines.length;
            const stationNames = [...new Set(todayDeadlines.map(n => n.station))].join(', ');
            
            toastMessage.innerHTML = `
                <strong>${count} assessment${count > 1 ? 's' : ''} due today!</strong><br>
                <small>${stationNames}</small>
            `;
            
            const toastElement = document.getElementById('statusToast');
            toastElement.querySelector('.toast-header').style.backgroundColor = '#f39c12';
            toastElement.querySelector('.toast-header').innerHTML = `
                <i class="bi bi-alarm-fill me-2"></i>
                <strong class="me-auto">Deadline Alert</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            `;
            
            statusToast.show();
            
            // Play notification sound if available
            playNotificationSound();
        }

        // Play notification sound
        function playNotificationSound() {
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ');
                audio.play();
            } catch (e) {
                // Fallback: Use browser notification if available
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Training Deadlines', {
                        body: 'Assessments due today! Check the notifications.',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23f39c12"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'
                    });
                }
            }
        }

        // Toggle notifications panel
        function toggleNotifications() {
            if (notificationPanel.style.display === 'none') {
                notificationPanel.style.display = 'block';
            } else {
                notificationPanel.style.display = 'none';
            }
        }

        // Close all notifications
        function closeAllNotifications() {
            notificationPanel.style.display = 'none';
        }

        // Manually check deadlines
        function checkDeadlinesNow() {
            checkTrainingDeadlines();
            showToast("Deadlines checked", "success");
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
        }

        // Render stations list
        function renderStationsList() {
            stationsList.innerHTML = '';
            stations.forEach((station, index) => {
                const stationTag = document.createElement('div');
                stationTag.className = 'station-tag';
                stationTag.innerHTML = `
                    <span class="badge bg-secondary">${station.code}</span>
                    <span class="flex-grow-1">${station.name}</span>
                    <button class="btn btn-sm btn-outline-primary" onclick="editStation('${station.id}')" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="removeStation('${station.id}')" title="Remove">
                        <i class="bi bi-x"></i>
                    </button>
                `;
                stationsList.appendChild(stationTag);
            });
            totalStationsEl.textContent = stations.length;
        }

        // Add new station
        function addNewStation() {
            const name = newStationNameInput.value.trim();
            if (!name) {
                showToast("Please enter a station name", "warning");
                return;
            }
            
            if (stations.some(s => s.name.toLowerCase() === name.toLowerCase())) {
                showToast("Station already exists", "warning");
                return;
            }
            
            const id = name.toLowerCase().replace(/\s+/g, '-');
            const code = name.substring(0, 3).toUpperCase();
            
            stations.push({ id, name, code });
            saveConfig();
            renderStationsList();
            renderTable();
            newStationNameInput.value = '';
            showToast(`Station "${name}" added`, "success");
            
            // Focus back to input
            newStationNameInput.focus();
        }

        // Edit station
        function editStation(stationId) {
            const station = stations.find(s => s.id === stationId);
            if (station) {
                editingStationId = stationId;
                editStationNameInput.value = station.name;
                editStationCodeInput.value = station.code;
                editStationModal.show();
            }
        }

        // Save station edit
        function saveStationEdit() {
            if (!editingStationId) return;
            
            const newName = editStationNameInput.value.trim();
            const newCode = editStationCodeInput.value.trim().toUpperCase();
            
            if (!newName || !newCode) {
                showToast("Name and code are required", "warning");
                return;
            }
            
            const stationIndex = stations.findIndex(s => s.id === editingStationId);
            if (stationIndex !== -1) {
                const oldName = stations[stationIndex].name;
                stations[stationIndex].name = newName;
                stations[stationIndex].code = newCode;
                
                saveConfig();
                renderStationsList();
                renderTable();
                editStationModal.hide();
                showToast(`Station renamed from "${oldName}" to "${newName}"`, "success");
            }
        }

        // Remove station
        function removeStation(stationId) {
            if (stations.length <= 1) {
                showToast("Cannot remove all stations", "warning");
                return;
            }
            
            const station = stations.find(s => s.id === stationId);
            if (!station) return;
            
            if (confirm(`Remove station "${station.name}"? This will delete training data for this station.`)) {
                stations = stations.filter(s => s.id !== stationId);
                
                employees.forEach(employee => {
                    if (employee.stations && employee.stations[stationId]) {
                        delete employee.stations[stationId];
                    }
                });
                
                saveConfig();
                renderStationsList();
                renderTable();
                updateProgressSummary();
                showToast(`Station "${station.name}" removed`, "success");
            }
        }

        // Reset to default stations
        function resetToDefaultStations() {
            if (confirm("Reset to default restaurant stations? Custom stations will be lost.")) {
                stations = [...DEFAULT_STATIONS];
                
                employees.forEach(employee => {
                    if (employee.stations) {
                        const newStations = {};
                        stations.forEach(station => {
                            if (employee.stations[station.id]) {
                                newStations[station.id] = employee.stations[station.id];
                            }
                        });
                        employee.stations = newStations;
                    }
                });
                
                saveConfig();
                renderStationsList();
                renderTable();
                updateProgressSummary();
                showToast("Reset to default restaurant stations", "success");
            }
        }

        // Export stations list
        function exportStationsList() {
            const stationData = stations.map(s => `${s.code} - ${s.name}`);
            const blob = new Blob([stationData.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `stations_list_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast("Stations list exported", "success");
        }

        // Render table
        function renderTable() {
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            const headerRow = document.createElement('tr');
            
            // Employee Name
            const thEmployee = document.createElement('th');
            thEmployee.className = 'employee-name-cell';
            thEmployee.innerHTML = '<i class="bi bi-person me-1"></i>Employee';
            headerRow.appendChild(thEmployee);
            
            // Employee ID
            const thEmployeeId = document.createElement('th');
            thEmployeeId.className = 'employee-id-cell';
            thEmployeeId.innerHTML = '<i class="bi bi-id-card me-1"></i>ID';
            headerRow.appendChild(thEmployeeId);
            
            // Date Range
            const thDate = document.createElement('th');
            thDate.innerHTML = '<i class="bi bi-calendar-range me-1"></i>Date Range';
            thDate.style.minWidth = '200px';
            headerRow.appendChild(thDate);
            
            // Station headers
            stations.forEach(station => {
                const th = document.createElement('th');
                th.className = 'station-header';
                th.innerHTML = `
                    <div class="station-header-content">
                        <div class="station-name">${station.name}</div>
                        <div class="station-code">${station.code}</div>
                        <button class="btn btn-sm edit-btn" onclick="editStation('${station.id}')" title="Edit Station">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </div>
                `;
                headerRow.appendChild(th);
            });
            
            // Actions
            const thActions = document.createElement('th');
            thActions.innerHTML = '<i class="bi bi-gear me-1"></i>Actions';
            thActions.style.minWidth = '120px';
            headerRow.appendChild(thActions);
            
            thead.appendChild(headerRow);
            
            // Load data rows
            loadDataRows();
            highlightDeadlineCells();
        }

        // Load data rows
        function loadDataRows() {
            if (employees.length > 0) {
                employees.forEach(employee => addEmployeeRow(employee));
            }
        }

        // Add employee
        function addEmployee(employeeData = {}) {
            const employeeId = employeeData.id || `${employeeIdInput.value || "EMP-"}${nextEmployeeId++}`;
            
            const newEmployee = {
                id: employeeId,
                name: employeeData.name || "",
                employeeId: employeeData.employeeId || employeeId,
                dateFrom: employeeData.dateFrom || "",
                dateTo: employeeData.dateTo || "",
                stations: employeeData.stations || {}
            };
            
            employees.push(newEmployee);
            saveConfig();
            addEmployeeRow(newEmployee);
            updateProgressSummary();
            showToast("Employee added successfully", "success");
            
            return employeeId;
        }

        // Add employee row
        function addEmployeeRow(employee) {
            const tr = document.createElement("tr");
            tr.dataset.employeeId = employee.id;
            
            // Employee Name
            const tdName = document.createElement("td");
            tdName.className = 'employee-name-cell';
            const inputName = document.createElement("input");
            inputName.type = "text";
            inputName.className = "form-control form-control-sm";
            inputName.placeholder = "Full Name";
            inputName.value = employee.name || "";
            inputName.oninput = () => {
                saveEmployeeField(employee.id, 'name', inputName.value);
                updateProgressSummary();
            };
            tdName.appendChild(inputName);
            tr.appendChild(tdName);
            
            // Employee ID
            const tdEmployeeId = document.createElement("td");
            tdEmployeeId.className = 'employee-id-cell';
            const inputEmployeeId = document.createElement("input");
            inputEmployeeId.type = "text";
            inputEmployeeId.className = "form-control form-control-sm";
            inputEmployeeId.placeholder = "ID";
            inputEmployeeId.value = employee.employeeId || employee.id;
            inputEmployeeId.oninput = () => saveEmployeeField(employee.id, 'employeeId', inputEmployeeId.value);
            tdEmployeeId.appendChild(inputEmployeeId);
            tr.appendChild(tdEmployeeId);
            
            // Date Range
            const tdDate = document.createElement("td");
            tdDate.innerHTML = `
                <div class="date-range-inputs">
                    <input type="date" class="form-control form-control-sm" 
                           value="${employee.dateFrom || ''}" 
                           onchange="saveEmployeeField('${employee.id}', 'dateFrom', this.value)">
                    <span class="date-range-separator">to</span>
                    <input type="date" class="form-control form-control-sm" 
                           value="${employee.dateTo || ''}" 
                           onchange="saveEmployeeField('${employee.id}', 'dateTo', this.value)">
                </div>
            `;
            tr.appendChild(tdDate);
            
            // Station cells
            stations.forEach(station => {
                const stationData = employee.stations && employee.stations[station.id] 
                    ? employee.stations[station.id] 
                    : { status: "", trainer: "", completionDate: "" };
                
                const td = document.createElement("td");
                td.className = 'station-cell';
                
                if (stationData.status === "Completed") td.classList.add("completed");
                else if (stationData.status === "In Progress") td.classList.add("in-progress");
                else if (stationData.status === "Pending") td.classList.add("pending");
                
                td.innerHTML = `
                    <div class="station-inputs">
                        <select class="form-select form-select-sm station-status-select" 
                                onchange="saveEmployeeStation('${employee.id}', '${station.id}', 'status', this.value); checkTrainingDeadlines();">
                            <option value="">Status</option>
                            <option value="Not Started" ${stationData.status === "Not Started" ? "selected" : ""}>Not Started</option>
                            <option value="In Progress" ${stationData.status === "In Progress" ? "selected" : ""}>In Progress</option>
                            <option value="Pending" ${stationData.status === "Pending" ? "selected" : ""}>Pending</option>
                            <option value="Completed" ${stationData.status === "Completed" ? "selected" : ""}>Completed</option>
                        </select>
                        <select class="form-select form-select-sm station-trainer-select" 
                                onchange="saveEmployeeStation('${employee.id}', '${station.id}', 'trainer', this.value)">
                            <option value="">Trainer</option>
                            ${trainers.map(trainer => 
                                `<option value="${trainer}" ${stationData.trainer === trainer ? "selected" : ""}>${trainer}</option>`
                            ).join('')}
                        </select>
                        <input type="date" class="form-control form-control-sm station-date-input" 
                               value="${stationData.completionDate || ''}"
                               onchange="saveEmployeeStation('${employee.id}', '${station.id}', 'completionDate', this.value); checkTrainingDeadlines();">
                    </div>
                `;
                tr.appendChild(td);
            });
            
            // Actions
            const tdActions = document.createElement("td");
            tdActions.className = 'action-buttons';
            tdActions.innerHTML = `
                <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteEmployee('${employee.id}', this)">
                    <i class="bi bi-trash"></i>
                </button>
                <button class="btn btn-sm btn-outline-primary btn-action" onclick="duplicateEmployee('${employee.id}')">
                    <i class="bi bi-copy"></i>
                </button>
                <button class="btn btn-sm btn-outline-success btn-action" onclick="markAllCompleted('${employee.id}')">
                    <i class="bi bi-check-all"></i>
                </button>
            `;
            tr.appendChild(tdActions);
            
            tbody.appendChild(tr);
        }

        // Save employee field
        function saveEmployeeField(employeeId, field, value) {
            const employee = employees.find(e => e.id === employeeId);
            if (employee) {
                employee[field] = value;
                saveConfig();
                updateProgressSummary();
            }
        }

        // Save employee station data
        function saveEmployeeStation(employeeId, stationId, field, value) {
            const employee = employees.find(e => e.id === employeeId);
            if (employee) {
                if (!employee.stations) employee.stations = {};
                if (!employee.stations[stationId]) employee.stations[stationId] = {};
                employee.stations[stationId][field] = value;
                
                // Update cell styling
                if (field === 'status') {
                    const row = document.querySelector(`tr[data-employee-id="${employeeId}"]`);
                    if (row) {
                        const stationIndex = stations.findIndex(s => s.id === stationId);
                        if (stationIndex !== -1) {
                            const cell = row.querySelector(`td:nth-child(${stationIndex + 4})`);
                            if (cell) {
                                cell.classList.remove("completed", "in-progress", "pending");
                                if (value === "Completed") cell.classList.add("completed");
                                else if (value === "In Progress") cell.classList.add("in-progress");
                                else if (value === "Pending") cell.classList.add("pending");
                            }
                        }
                    }
                }
                
                saveConfig();
                updateProgressSummary();
                
                // Check deadlines when completion date changes
                if (field === 'completionDate' && enableNotifications.checked) {
                    setTimeout(() => checkTrainingDeadlines(), 100);
                }
            }
        }

        // Delete employee
        function deleteEmployee(employeeId, button) {
            if (confirm("Delete this employee and all training records?")) {
                employees = employees.filter(e => e.id !== employeeId);
                const row = button.closest("tr");
                row.remove();
                saveConfig();
                updateProgressSummary();
                checkTrainingDeadlines();
                showToast("Employee deleted", "success");
            }
        }

        // Duplicate employee
        function duplicateEmployee(employeeId) {
            const employee = employees.find(e => e.id === employeeId);
            if (employee) {
                const newEmployee = {
                    ...employee,
                    id: `${employee.employeeId}-copy-${Date.now()}`,
                    name: `${employee.name} (Copy)`,
                    employeeId: `${employee.employeeId}-COPY`
                };
                addEmployee(newEmployee);
            }
        }

        // Mark all stations completed for employee
        function markAllCompleted(employeeId) {
            if (confirm("Mark all stations as completed for this employee?")) {
                const employee = employees.find(e => e.id === employeeId);
                if (employee) {
                    if (!employee.stations) employee.stations = {};
                    stations.forEach(station => {
                        if (!employee.stations[station.id]) {
                            employee.stations[station.id] = {};
                        }
                        employee.stations[station.id].status = "Completed";
                        employee.stations[station.id].completionDate = new Date().toISOString().split('T')[0];
                    });
                    saveConfig();
                    renderTable();
                    updateProgressSummary();
                    checkTrainingDeadlines();
                    showToast("All stations marked as completed", "success");
                }
            }
        }

        // Update trainers
        function updateTrainers() {
            const trainerText = trainerListInput.value;
            trainers = trainerText.split(",").map(t => t.trim()).filter(t => t);
            
            if (trainers.length === 0) {
                trainers = ["Odin", "Mueen", "Sarah"];
                trainerListInput.value = trainers.join(", ");
            }
            
            saveConfig();
            renderTable();
            updateProgressSummary();
            showToast("Trainers updated", "success");
        }

        // Add multiple employees
        function addMultipleRows() {
            const baseId = employeeIdInput.value.trim() || "EMP-";
            for (let i = 0; i < 5; i++) {
                const employeeId = `${baseId}${nextEmployeeId++}`;
                addEmployee({
                    id: employeeId,
                    employeeId: employeeId,
                    name: `Employee ${nextEmployeeId}`
                });
            }
        }

        // Update progress summary
        function updateProgressSummary() {
            const totalEmployees = employees.length;
            totalEmployeesEl.textContent = totalEmployees;
            
            let totalStationsCompleted = 0;
            let totalPossibleStations = totalEmployees * stations.length;
            
            const activeTrainersSet = new Set();
            
            employees.forEach(employee => {
                if (employee.stations) {
                    stations.forEach(station => {
                        const stationData = employee.stations[station.id];
                        if (stationData) {
                            if (stationData.status === "Completed") {
                                totalStationsCompleted++;
                            }
                            if (stationData.trainer) {
                                activeTrainersSet.add(stationData.trainer);
                            }
                        }
                    });
                }
            });
            
            const completionPercentage = totalPossibleStations > 0 
                ? Math.round((totalStationsCompleted / totalPossibleStations) * 100)
                : 0;
            
            trainingCompletionEl.textContent = `${completionPercentage}%`;
            activeTrainersEl.textContent = activeTrainersSet.size;
        }

        // Export to Excel
        function exportExcel() {
            const excelData = [
                ["Restaurant KS22 - Training Plan"],
                ["Store:", storeInput.value],
                ["Month:", monthInput.value],
                ["Generated:", new Date().toLocaleString()],
                [],
                ["Employee Details", "", "", ...stations.map(s => `${s.name} (${s.code})`)],
                ["", "", "", ...stations.map(() => ""), ...stations.map(() => ""), ...stations.map(() => "")],
                []
            ];
            
            const headerRow = ["Employee Name", "Employee ID", "Date Range"];
            stations.forEach(() => {
                headerRow.push("Status", "Trainer", "Completion Date");
            });
            excelData.push(headerRow);
            
            employees.forEach(employee => {
                const row = [
                    employee.name || "",
                    employee.employeeId || "",
                    `${employee.dateFrom || ""} to ${employee.dateTo || ""}`
                ];
                
                stations.forEach(station => {
                    const stationData = employee.stations && employee.stations[station.id];
                    row.push(
                        stationData?.status || "",
                        stationData?.trainer || "",
                        stationData?.completionDate || ""
                    );
                });
                
                excelData.push(row);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Training Plan");
            
            // Auto-size columns
            const maxWidth = 25;
            const colWidths = [];
            for (let i = 0; i < excelData[0].length; i++) {
                let maxLength = 0;
                for (let j = 0; j < excelData.length; j++) {
                    maxLength = Math.max(maxLength, (excelData[j][i] || "").toString().length);
                }
                colWidths.push({ wch: Math.min(maxLength + 2, maxWidth) });
            }
            ws['!cols'] = colWidths;
            
            XLSX.writeFile(wb, `KS22_Training_Plan_${storeInput.value}_${monthInput.value.replace('-', '_')}.xlsx`);
            showToast("Excel file exported successfully", "success");
        }

        // Export to PDF (simulated)
        function exportPDF() {
            showToast("PDF export feature coming soon!", "info");
        }

        // Print table
        function printTable() {
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Restaurant KS22 - Training Plan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; }
                        h2 { color: #666; text-align: center; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 11px; }
                        th, td { border: 1px solid #333; padding: 6px; text-align: center; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        .completed { background-color: #d4edda; }
                        .in-progress { background-color: #fff3cd; }
                        .pending { background-color: #f8d7da; }
                        @page { size: landscape; margin: 0.5cm; }
                    </style>
                </head>
                <body>
                    <h1>Restaurant KS22 - Training Plan</h1>
                    <h2>${storeInput.value} - ${monthInput.value}</h2>
                    <h3>Generated: ${new Date().toLocaleString()}</h3>
                    ${document.querySelector('.training-table').outerHTML}
                    <div style="margin-top: 30px; font-size: 10px; color: #666;">
                        <p><strong>Legend:</strong> Completed (Green) | In Progress (Yellow) | Pending (Red)</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Generate report
        function generateReport() {
            if (employees.length === 0) {
                showToast("No data to generate report", "warning");
                return;
            }
            
            const completion = trainingCompletionEl.textContent;
            const totalEmp = totalEmployeesEl.textContent;
            const totalStat = totalStationsEl.textContent;
            const activeTrain = activeTrainersEl.textContent;
            
            const report = `
                RESTAURANT KS22 TRAINING REPORT
                ================================
                
                Store: ${storeInput.value}
                Period: ${monthInput.value}
                Generated: ${new Date().toLocaleString()}
                
                SUMMARY STATISTICS:
                 Total Employees: ${totalEmp}
                 Training Completion: ${completion}
                 Total Stations: ${totalStat}
                 Active Trainers: ${activeTrain}
                
                STATIONS LIST:
                ${stations.map(s => ` ${s.code}: ${s.name}`).join('\n')}
                
                EMPLOYEE TRAINING STATUS:
                ${employees.map(emp => {
                    const completed = stations.filter(s => emp.stations?.[s.id]?.status === "Completed").length;
                    return ` ${emp.name} (${emp.employeeId}): ${completed}/${stations.length} stations completed`;
                }).join('\n')}
            `;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `training_report_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast("Report generated successfully", "success");
        }

        // Clear all data
        function clearAll() {
            if (confirm("Clear all training data? This cannot be undone.")) {
                employees = [];
                nextEmployeeId = 1001;
                localStorage.removeItem("restaurantTrainingConfig");
                tbody.innerHTML = "";
                storeInput.value = "KS-22";
                monthInput.value = `${new Date().getFullYear()}-${(new Date().getMonth() + 1).toString().padStart(2, '0')}`;
                updateProgressSummary();
                checkTrainingDeadlines();
                showToast("All data cleared", "warning");
            }
        }

        // Show toast notification
        function showToast(message, type = "info") {
            const colors = {
                success: "#28a745",
                error: "#dc3545",
                warning: "#ffc107",
                info: "#17a2b8"
            };
            
            const toastElement = document.getElementById('statusToast');
            toastElement.querySelector('.toast-header').style.backgroundColor = colors[type] || colors.info;
            toastElement.querySelector('.toast-header').style.color = "white";
            toastMessage.textContent = message;
            statusToast.show();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auto-save on input changes
            storeInput.addEventListener('input', () => {
                saveConfig();
                updateProgressSummary();
            });
            
            monthInput.addEventListener('input', () => {
                saveConfig();
                updateProgressSummary();
            });
            
            // Add station on Enter key
            newStationNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addNewStation();
            });
            
            // Add employee on Enter in trainer list
            trainerListInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') updateTrainers();
            });
            
            // Enable/disable notifications
            enableNotifications.addEventListener('change', () => {
                saveConfig();
                if (enableNotifications.checked) {
                    startNotificationChecker();
                    checkTrainingDeadlines();
                    showToast("Notifications enabled", "success");
                } else {
                    if (notificationCheckInterval) {
                        clearInterval(notificationCheckInterval);
                    }
                    showToast("Notifications disabled", "info");
                }
            });
            
            // Close notification panel when clicking outside
            document.addEventListener('click', (e) => {
                if (!notificationPanel.contains(e.target) && 
                    !notificationBadge.contains(e.target) && 
                    notificationPanel.style.display === 'block') {
                    notificationPanel.style.display = 'none';
                }
            });
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>