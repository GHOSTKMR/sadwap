<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kudu Assistant - PDF Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root {
            --primary-color: #6f42c1;
            --secondary-color: #0dcaf0;
            --dark-bg: #121212;
            --darker-bg: #0a0a0a;
            --card-bg: #1e1e1e;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border-color: #343a40;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .chat-container {
            max-width: 1400px;
            height: 95vh;
            background-color: var(--darker-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .chat-sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #4a1e8a 100%);
            color: white;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }

        .chat-main {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            background: linear-gradient(90deg, var(--primary-color) 0%, #4a1e8a 100%);
            color: white;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--dark-bg);
        }

        .message {
            max-width: 85%;
            padding: 12px 18px;
            border-radius: 18px;
            margin-bottom: 15px;
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            text-align: right;
            margin-top: 5px;
        }

        .pdf-viewer-container {
            display: none;
            flex-direction: column;
            height: 100%;
            border-left: 1px solid var(--border-color);
            background-color: var(--dark-bg);
        }

        .pdf-viewer-container.active {
            display: flex;
        }

        .pdf-header {
            padding: 12px 20px;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-viewer {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--card-bg);
            padding: 20px;
            overflow: auto;
        }

        .pdf-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--darker-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .pdf-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: var(--dark-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .pdf-text-content {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            line-height: 1.6;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
        }

        .pdf-page {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color), #8b5cf6);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .chat-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            background-color: var(--darker-bg);
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--card-bg);
            color: var(--text-secondary);
            padding: 12px 18px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            font-style: italic;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .typing-indicator.active {
            display: block;
        }

        .welcome-message {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-secondary);
            background-color: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .suggestion {
            display: inline-block;
            background-color: rgba(111, 66, 193, 0.2);
            color: var(--secondary-color);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(111, 66, 193, 0.3);
        }

        .suggestion:hover {
            background-color: rgba(111, 66, 193, 0.4);
            transform: translateY(-2px);
        }

        .pdf-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pdf-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .feature-list {
            list-style-type: none;
            padding-left: 0;
        }

        .feature-list li {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-action {
            background-color: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
            text-align: center;
        }

        .quick-action:hover {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .developer-info {
            background: linear-gradient(135deg, rgba(13, 202, 240, 0.1), rgba(111, 66, 193, 0.1));
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(13, 202, 240, 0.2);
            font-size: 0.85rem;
        }

        .message-content {
            line-height: 1.5;
        }

        .greeting-message {
            background: linear-gradient(135deg, rgba(13, 202, 240, 0.1), rgba(111, 66, 193, 0.1));
            border-left: 4px solid var(--secondary-color);
        }

        .pdf-error {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
        }

        .pdf-alternative {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }

        .search-box {
            background-color: var(--darker-bg);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .highlight {
            background-color: yellow;
            color: black;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 992px) {
            .chat-container {
                height: 95vh;
            }
            
            .message {
                max-width: 90%;
            }
            
            .pdf-viewer-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 100;
                background-color: var(--dark-bg);
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--darker-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5a2da3;
        }
    </style>
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div class="col-12 h-100">
                <div class="chat-container d-flex">
                    <!-- Sidebar -->
                    <div class="chat-sidebar col-md-4 col-lg-3">
                        <div class="d-flex flex-column h-100">
                            <div class="text-center mb-4">
                                <h2><i class="bi bi-robot me-2"></i>Kudu Assistant</h2>
                                <p class="mb-0">Your intelligent PDF document helper</p>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3"><i class="bi bi-collection-play me-2"></i>Quick Actions</h5>
                                <button class="quick-action" onclick="insertSuggestion('Hello')">
                                    <i class="bi bi-chat-dots me-2"></i>Start Conversation
                                </button>
                                <button class="quick-action" onclick="insertSuggestion('list pdfs')">
                                    <i class="bi bi-list-ul me-2"></i>List Available PDFs
                                </button>
                                <button class="quick-action" onclick="insertSuggestion('help')">
                                    <i class="bi bi-question-circle me-2"></i>Get Help
                                </button>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3"><i class="bi bi-file-pdf me-2"></i>PDF Documents</h5>
                                <div class="pdf-list">
                                    <div class="pdf-item" onclick="openPDF('lafino_chicken')">
                                        <div class="fw-bold">Lafino Chicken</div>
                                        <div class="small">Product information and recipes</div>
                                    </div>
                                    <div class="pdf-item" onclick="openPDF('kudu_beef')">
                                        <div class="fw-bold">Kudu Beef</div>
                                        <div class="small">Beef products and nutritional info</div>
                                    </div>
                                    <div class="pdf-item" onclick="openPDF('kudu_chicken')">
                                        <div class="fw-bold">Kudu Chicken</div>
                                        <div class="small">Chicken products and preparation</div>
                                    </div>
                                    <div class="pdf-item" onclick="openPDF('philly_beef')">
                                        <div class="fw-bold">Philly Beef</div>
                                        <div class="small">Beef products and recipes</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-auto">
                                <div class="developer-info">
                                    <h6><i class="bi bi-code-slash me-2"></i>Developer Info</h6>
                                    <p class="mb-1">Developed by Kudu Assistant AKA Ghost</p>
                                    <p class="mb-0 small">Still under training for improvement and trying to access other sources for more information and knowledge!</p>
                                    <p class="mb-0 small mt-2"><i class="bi bi-c-circle me-1"></i>Bootstrap 2025 - All devices optimized</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Main Chat Area -->
                    <div class="chat-main col-md-8 col-lg-6">
                        <div class="chat-header">
                            <h4 class="mb-0"><i class="bi bi-chat-left-text me-2"></i>PDF Assistant</h4>
                        </div>
                        <div class="chat-body" id="chatBody">
                            <div class="welcome-message">
                                <h4>Welcome to Kudu Assistant! <i class="bi bi-emoji-smile"></i></h4>
                                <p class="mb-3">I'm your intelligent PDF assistant. I can help you view documents, answer questions, and provide information from available PDFs.</p>
                                <p class="mb-0">Try asking me something or select a PDF from the sidebar to get started!</p>
                            </div>
                            
                            <div class="greeting-message p-3 mb-3 rounded">
                                <p class="mb-1"><strong>Greeting Examples:</strong></p>
                                <div class="suggestion" onclick="insertSuggestion('Hello! How are you?')">Hello! How are you?</div>
                                <div class="suggestion" onclick="insertSuggestion('Good morning!')">Good morning!</div>
                                <div class="suggestion" onclick="insertSuggestion('What can you help me with?')">What can you help me with?</div>
                            </div>
                        </div>
                        <div class="typing-indicator" id="typingIndicator">
                            <i class="bi bi-three-dots"></i> Kudu Assistant is typing...
                        </div>
                        <div class="chat-footer">
                            <div class="input-group">
                                <input type="text" class="form-control" id="chatInput" placeholder="Type your message here...">
                                <button class="btn btn-primary" id="sendButton" type="button">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                            <div class="mt-2 text-center">
                                <small class="text-muted">Try: <span class="suggestion small" onclick="insertSuggestion('Show me Lafino Chicken PDF')">Show me Lafino Chicken PDF</span> or <span class="suggestion small" onclick="insertSuggestion('What PDFs do you have?')">What PDFs do you have?</span></small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PDF Viewer -->
                    <div class="pdf-viewer-container col-lg-3" id="pdfViewerContainer">
                        <div class="pdf-header">
                            <h5 class="mb-0" id="pdfTitle">PDF Document</h5>
                            <button class="btn btn-sm btn-outline-light" onclick="closePDF()">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <div class="pdf-controls">
                            <div class="d-flex gap-2 align-items-center">
                                <button class="btn btn-sm btn-outline-light" onclick="prevPage()" id="prevPage">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <span class="text-light small" id="pageInfo">Page 1 of 1</span>
                                <button class="btn btn-sm btn-outline-light" onclick="nextPage()" id="nextPage">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                            <div class="search-box">
                                <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Search in document...">
                            </div>
                        </div>
                        <div class="pdf-viewer">
                            <div id="pdfLoading" class="text-center text-light" style="display: none;">
                                <div class="spinner-border text-primary mb-3" role="status">
                                    <span class="visually-hidden">Loading PDF...</span>
                                </div>
                                <p>Extracting text from PDF...</p>
                            </div>
                            <div id="pdfError" class="pdf-error" style="display: none;">
                                <i class="bi bi-exclamation-triangle display-4 mb-3"></i>
                                <h5>PDF Loading Error</h5>
                                <p>Unable to load the PDF document. This could be due to:</p>
                                <ul class="text-start">
                                    <li>PDF file not found</li>
                                    <li>Network connectivity issues</li>
                                    <li>Browser security restrictions</li>
                                </ul>
                            </div>
                            <div class="pdf-content" id="pdfContent" style="display: none;">
                                <div class="pdf-text-content" id="pdfTextContent">
                                    <!-- PDF text content will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Set up PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const chatBody = document.getElementById('chatBody');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const pdfViewerContainer = document.getElementById('pdfViewerContainer');
        const pdfTitle = document.getElementById('pdfTitle');
        const pdfLoading = document.getElementById('pdfLoading');
        const pdfError = document.getElementById('pdfError');
        const pdfContent = document.getElementById('pdfContent');
        const pdfTextContent = document.getElementById('pdfTextContent');
        const pageInfo = document.getElementById('pageInfo');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const searchInput = document.getElementById('searchInput');

        // PDF state variables
        let currentPDF = null;
        let pdfDoc = null;
        let pageNum = 1;
        let extractedText = [];
        let searchTerm = '';

        // PDF Database with GitHub raw URLs
        const pdfDatabase = {
            "lafino_chicken": {
                name: "Lafino Chicken",
                path: "https://raw.githubusercontent.com/GHOSTKMR/sadwap/main/lafino%20chicken.pdf",
                description: "Information about chicken products, recipes, and nutritional information."
            },
            "kudu_beef": {
                name: "Kudu Beef",
                path: "https://raw.githubusercontent.com/GHOSTKMR/sadwap/main/kudu%20beef.pdf",
                description: "Information about beef products, recipes, and nutritional information."
            },
            "kudu_chicken": {
                name: "Kudu Chicken",
                path: "https://raw.githubusercontent.com/GHOSTKMR/sadwap/main/kuduchicken.pdf",
                description: "Information about chicken products, recipes, and nutritional information."
            },
            "philly_beef": {
                name: "Philly Beef",
                path: "https://raw.githubusercontent.com/GHOSTKMR/sadwap/main/philly%20beef.pdf",
                description: "Information about beef products, recipes, and nutritional information."
            }
        };

        // Greeting messages
        const greetings = [
            "Hello! How can I assist you today?",
            "Hi there! What can I help you with?",
            "Greetings! I'm here to help with your PDF documents.",
            "Good day! How may I be of service?"
        ];

        // Farewell messages
        const farewells = [
            "Goodbye! Feel free to return if you need more assistance.",
            "See you later! Don't hesitate to ask if you have more questions.",
            "Farewell! I'm here whenever you need help with PDFs.",
            "Take care! Remember I'm just a message away if you need me."
        ];

        // Get current time
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Get current date
        function getCurrentDate() {
            const now = new Date();
            return now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        // Add a message to the chat
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'd-flex', 'flex-column');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            
            // Handle line breaks in the message
            const lines = message.split('\n');
            lines.forEach((line, index) => {
                if (line.trim() !== '') {
                    const lineElement = document.createElement('div');
                    lineElement.textContent = line;
                    if (index > 0) {
                        lineElement.style.marginTop = '5px';
                    }
                    messageContent.appendChild(lineElement);
                }
            });
            
            const timeStamp = document.createElement('div');
            timeStamp.classList.add('message-time');
            timeStamp.textContent = getCurrentTime();
            
            messageDiv.appendChild(messageContent);
            messageDiv.appendChild(timeStamp);
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            typingIndicator.classList.add('active');
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.classList.remove('active');
        }

        // Handle user input
        function handleUserInput() {
            const message = chatInput.value.trim();
            if (message === '') return;

            // Add user message to chat
            addMessage(message, true);
            chatInput.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Process bot response after a short delay
            setTimeout(() => {
                hideTypingIndicator();
                processBotResponse(message.toLowerCase());
            }, 1500);
        }

        // Process bot response
        function processBotResponse(message) {
            // Greetings
            if (message.includes('hello') || message.includes('hi') || message.includes('hey') || 
                message.includes('good morning') || message.includes('good afternoon') || message.includes('good evening')) {
                const greeting = greetings[Math.floor(Math.random() * greetings.length)];
                addMessage(greeting);
            }
            // Farewells
            else if (message.includes('bye') || message.includes('goodbye') || message.includes('see you') || 
                     message.includes('farewell') || message.includes('cya')) {
                const farewell = farewells[Math.floor(Math.random() * farewells.length)];
                addMessage(farewell);
            }
            // How are you
            else if (message.includes('how are you') || message.includes('how do you do')) {
                addMessage("I'm functioning well, thank you for asking! How can I assist you today?");
            }
            // Thanks
            else if (message.includes('thank') || message.includes('thanks')) {
                addMessage("You're welcome! Is there anything else I can help you with?");
            }
            // Date and time
            else if (message.includes('time') || message.includes('date')) {
                if (message.includes('date')) {
                    addMessage(`Today is ${getCurrentDate()}`);
                } else {
                    addMessage(`The current time is ${getCurrentTime()}`);
                }
            }
            // PDF requests
            else if (message.includes('lafino chicken')) {
                openPDF('lafino_chicken');
            } else if (message.includes('kudu beef')) {
                openPDF('kudu_beef');
            } else if (message.includes('kudu chicken')) {
                openPDF('kudu_chicken');
            } else if (message.includes('philly beef')) {
                openPDF('philly_beef');
            } else if (message.includes('list pdfs') || message.includes('available pdfs') || message.includes('what pdf')) {
                listPDFs();
            } else if (message.includes('help')) {
                addMessage("I can help you with:\n• Viewing PDF documents (just ask for one by name)\n• Answering questions about PDF content\n• Providing general assistance\n\nTry saying 'Show me Lafino Chicken PDF' or 'What PDFs do you have?'");
            } else {
                addMessage("I'm not sure how to help with that. You can ask me to show a PDF, list available documents, or just chat! Try 'help' for more options.");
            }

            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Extract text from PDF
        async function extractTextFromPDF(pdfPath) {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfPath);
                pdfDoc = await loadingTask.promise;
                
                extractedText = [];
                
                // Extract text from all pages
                for (let i = 1; i <= pdfDoc.numPages; i++) {
                    const page = await pdfDoc.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    extractedText.push({
                        page: i,
                        text: pageText
                    });
                }
                
                return extractedText;
            } catch (error) {
                console.error('Error extracting text from PDF:', error);
                throw error;
            }
        }

        // Display extracted text
        function displayExtractedText() {
            if (!extractedText.length) return;
            
            let htmlContent = '';
            
            extractedText.forEach((page, index) => {
                let pageText = page.text;
                
                // Highlight search term if present
                if (searchTerm) {
                    const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
                    pageText = pageText.replace(regex, '<span class="highlight">$1</span>');
                }
                
                htmlContent += `
                    <div class="pdf-page">
                        <div class="page-header">Page ${page.page}</div>
                        <div class="page-text">${pageText}</div>
                    </div>
                `;
            });
            
            pdfTextContent.innerHTML = htmlContent;
            updatePageControls();
        }

        // Escape special characters for regex
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Update page navigation controls
        function updatePageControls() {
            if (!extractedText.length) return;
            
            pageInfo.textContent = `Page ${pageNum} of ${extractedText.length}`;
            prevPageBtn.disabled = pageNum <= 1;
            nextPageBtn.disabled = pageNum >= extractedText.length;
            
            // Scroll to current page
            const pageElement = document.querySelector(`.pdf-page:nth-child(${pageNum})`);
            if (pageElement) {
                pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Previous page
        function prevPage() {
            if (pageNum <= 1) return;
            pageNum--;
            updatePageControls();
        }

        // Next page
        function nextPage() {
            if (pageNum >= extractedText.length) return;
            pageNum++;
            updatePageControls();
        }

        // Search in document
        function searchInDocument() {
            searchTerm = searchInput.value.trim();
            pageNum = 1; // Reset to first page when searching
            displayExtractedText();
            
            if (searchTerm) {
                addMessage(`Searching for "${searchTerm}" in the document...`);
            }
        }

        // Open a PDF and extract text
        async function openPDF(pdfId) {
            if (pdfDatabase[pdfId]) {
                const pdf = pdfDatabase[pdfId];
                currentPDF = pdf;
                pdfViewerContainer.classList.add('active');
                pdfTitle.textContent = pdf.name;
                
                // Show loading indicator
                pdfLoading.style.display = 'block';
                pdfError.style.display = 'none';
                pdfContent.style.display = 'none';
                
                // Reset state
                pageNum = 1;
                searchTerm = '';
                searchInput.value = '';
                
                try {
                    // Extract text from PDF
                    await extractTextFromPDF(pdf.path);
                    
                    // Display extracted text
                    displayExtractedText();
                    
                    // Show content
                    pdfLoading.style.display = 'none';
                    pdfContent.style.display = 'block';
                    
                    addMessage(`I've extracted the text from ${pdf.name} PDF and displayed it in the viewer. You can read the content and use the search feature to find specific information.`);
                    
                } catch (error) {
                    console.error('Error opening PDF:', error);
                    pdfLoading.style.display = 'none';
                    pdfError.style.display = 'block';
                    addMessage(`I tried to extract text from the ${pdf.name} PDF, but there was an error. The PDF might be corrupted or inaccessible.`);
                }
            } else {
                addMessage("Sorry, I couldn't find that PDF. Try 'list pdfs' to see available documents.");
            }
        }

        // List all available PDFs
        function listPDFs() {
            let pdfList = "Here are the PDF documents I have available:\n\n";
            for (const [key, pdf] of Object.entries(pdfDatabase)) {
                pdfList += `• ${pdf.name}: ${pdf.description}\n`;
            }
            pdfList += "\nJust ask for any of these by name!";
            addMessage(pdfList);
        }

        // Insert suggestion into input
        function insertSuggestion(text) {
            chatInput.value = text;
            chatInput.focus();
        }

        // Close PDF viewer
        function closePDF() {
            pdfViewerContainer.classList.remove('active');
            currentPDF = null;
            pdfDoc = null;
            extractedText = [];
        }

        // Event listeners
        sendButton.addEventListener('click', handleUserInput);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserInput();
            }
        });

        searchInput.addEventListener('input', searchInDocument);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchInDocument();
            }
        });

        // Initial bot message
        setTimeout(() => {
            addMessage("Hello! I'm Kudu Assistant, your PDF document helper. How can I assist you today?");
        }, 1000);
    </script>
</body>
</html>
